<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jempana - Booking Gunung Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f9fa;
      }
      .hero-section {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.5),
            rgba(0, 0, 0, 0.5)
          ),
          url("https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=2070&auto=format&fit=crop");
        background-size: cover;
        background-position: center;
      }
      .toast {
        transition: opacity 0.5s, transform 0.5s;
      }
    </style>
  </head>
  <body class="text-gray-800">
    <!-- Header & Navigasi -->
    <header class="bg-white sticky top-0 z-40 shadow-sm">
      <div class="bg-green-600 text-white text-sm">
        <div
          class="container mx-auto px-4 py-2 flex flex-col md:flex-row md:justify-between items-center"
        >
          <!-- <div class="flex items-center space-x-4 mb-1 md:mb-0">
            <span>0857-3234-2393</span>
            <span>official.mountaineer@gmail.com</span>
          </div> -->
          <div id="user-session" class="flex items-center space-x-4">
            <span id="user-greeting" class="hidden font-semibold"></span>
            <button id="login-btn" class="hover:underline">Masuk</button>
            <span id="separator" class="opacity-50">|</span>
            <button id="logout-btn" class="hidden hover:underline">
              Keluar
            </button>
            <button id="register-btn" class="hover:underline">Daftar</button>
          </div>
        </div>
      </div>
      <nav
        class="container mx-auto px-4 py-4 flex justify-between items-center"
      >
        <a
          href="#"
          class="text-2xl md:text-3xl font-bold text-gray-800 flex items-center"
        >
          <div
            class="w-0 h-0 border-l-[10px] border-l-transparent border-b-[18px] border-b-green-600 border-r-[10px] border-r-transparent mr-2"
          ></div>
          Jempana
        </a>
        <div class="hidden md:flex items-center space-x-6">
          <ul class="flex space-x-8 items-center text-lg">
            <li>
              <a
                href="#beranda"
                class="text-gray-600 hover:text-green-600 transition"
                >Beranda</a
              >
            </li>
            <li>
              <a
                href="#info-gunung"
                class="text-gray-600 hover:text-green-600 transition"
                >Info Gunung</a
              >
            </li>
            <li id="profil-nav-link" class="hidden">
              <a
                href="#profil-pengguna"
                class="text-gray-600 hover:text-green-600 transition"
                >Profil</a
              >
            </li>
            <li>
              <a
                href="#cek-booking"
                class="text-gray-600 hover:text-green-600 transition"
                >Cara Pemesanan</a
              >
            </li>
          </ul>
        </div>
        <!-- Tombol Hamburger Menu -->
        <div class="md:hidden">
          <button id="hamburger-btn" class="text-gray-800 focus:outline-none">
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
              ></path>
            </svg>
          </button>
        </div>
      </nav>
      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden md:hidden bg-white shadow-md">
        <ul class="flex flex-col items-center py-4 space-y-4">
          <li>
            <a
              href="#beranda"
              class="text-gray-600 hover:text-green-600 transition mobile-link"
              >Beranda</a
            >
          </li>
          <li>
            <a
              href="#info-gunung"
              class="text-gray-600 hover:text-green-600 transition mobile-link"
              >Info Gunung</a
            >
          </li>
          <li id="profil-nav-link-mobile" class="hidden">
            <a
              href="#profil-pengguna"
              class="text-gray-600 hover:text-green-600 transition mobile-link"
              >Profil</a
            >
          </li>
          <li>
            <a
              href="#cek-booking"
              class="text-gray-600 hover:text-green-600 transition mobile-link"
              >Cara Pemesanan</a
            >
          </li>
        </ul>
      </div>
    </header>

    <!-- Konten Utama -->
    <main>
      <!-- Bagian Hero -->
      <section
        id="beranda"
        class="hero-section h-[60vh] flex items-center justify-center text-white px-4"
      >
        <div class="text-center">
          <h1 class="text-4xl md:text-6xl font-bold mb-4">
            Mau mendaki ke mana?
          </h1>
          <div class="mt-8 max-w-2xl mx-auto">
            <input
              type="text"
              id="search-gunung"
              class="w-full p-4 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-4 focus:ring-green-500/50"
              placeholder="Temukan gunung tujuanmu disini"
            />
          </div>
        </div>
      </section>

      <!-- Bagian Info Gunung -->
      <section id="info-gunung" class="py-16 md:py-24 bg-gray-50">
        <div class="container mx-auto px-4">
          <h2 class="text-3xl font-bold text-center mb-12">
            Destinasi Populer
          </h2>
          <div
            id="gunung-list-container"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
          ></div>
          <p
            id="no-results"
            class="text-center text-gray-500 text-xl hidden mt-8"
          >
            Gunung tidak ditemukan.
          </p>
        </div>
      </section>

      <!-- Bagian Profil Pengguna (BARU) -->
      <section id="profil-pengguna" class="hidden py-16 md:py-24">
        <div class="container mx-auto px-4">
          <h2 class="text-3xl font-bold text-center mb-12">Profil Pengguna</h2>
          <div
            class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-xl"
          >
            <div class="mb-8 pb-8 border-b">
              <h3 class="text-2xl font-bold mb-4 text-gray-800">Detail Akun</h3>
              <p><strong>Nama:</strong> <span id="profil-nama"></span></p>
              <p><strong>Email:</strong> <span id="profil-email"></span></p>
            </div>
            <div>
              <h3 class="text-2xl font-bold mb-4 text-gray-800">
                Laporan Booking
              </h3>
              <div id="my-bookings-list" class="space-y-4">
                <!-- Riwayat booking akan dirender di sini -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Bagian Cek Booking -->
      <section id="cek-booking" class="py-16 md:py-24 bg-gray-50">
        <div class="container mx-auto px-4">
          <h2 class="text-3xl font-bold text-center mb-12">
            Cara Pemesanan & Lacak Status
          </h2>
          <div
            class="max-w-3xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-xl"
          >
            <div class="mb-10">
              <h3 class="text-2xl font-bold mb-4 text-gray-800">
                Langkah-langkah Pemesanan Tiket
              </h3>
              <ol class="list-decimal list-inside space-y-4 text-gray-700">
                <li>
                  <strong>Daftar atau Masuk Akun:</strong> Anda diwajibkan
                  memiliki akun untuk booking.
                </li>
                <li>
                  <strong>Pilih Destinasi Gunung:</strong> Jelajahi gunung di
                  bagian Info Gunung.
                </li>
                <li>
                  <strong>Lihat Detail Gunung:</strong> Klik pada gambar gunung
                  untuk info lengkap.
                </li>
                <li>
                  <strong>Mulai Proses Booking:</strong> Klik tombol "Booking
                  Sekarang".
                </li>
                <li>
                  <strong>Isi Formulir Booking:</strong> Lengkapi data yang
                  diperlukan.
                </li>
                <li>
                  <strong>Lakukan Pembayaran:</strong> Unggah bukti pembayaran
                  Anda.
                </li>
                <li>
                  <strong>Dapatkan Kode Booking:</strong> Simpan kode unik Anda
                  untuk melacak status.
                </li>
              </ol>
            </div>
            <hr class="my-8" />
            <div>
              <h3 class="text-2xl font-bold mb-4 text-gray-800">
                Lacak Status Booking Anda
              </h3>
              <form id="form-cek-booking">
                <div class="mb-4">
                  <label
                    for="kode_booking_cek"
                    class="block text-lg font-medium mb-2"
                    >Cari dengan Kode Booking</label
                  >
                  <input
                    type="text"
                    id="kode_booking_cek"
                    class="w-full p-3 border rounded-lg"
                    placeholder="Contoh: BK-20250726-ABCD"
                    required
                  />
                </div>
                <button
                  type="submit"
                  class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition"
                >
                  Cari Booking
                </button>
              </form>
              <div id="hasil-cek-booking" class="mt-8 hidden"></div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <!-- <footer class="bg-gray-800 text-white py-8">
      <div class="container mx-auto px-4 text-center">
        <p>&copy; 2025 Mountaineer.com. All Rights Reserved.</p>
      </div>
    </footer> -->

    <!-- Modals -->
    <div
      id="detail-modal"
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4"
    >
      <div
        class="bg-white rounded-lg shadow-2xl w-full max-w-3xl flex flex-col max-h-[90vh]"
      >
        <div class="p-6 border-b flex justify-between items-center">
          <h3 id="detail-modal-title" class="text-2xl font-bold"></h3>
          <button
            id="close-detail-modal-btn"
            class="text-gray-500 hover:text-gray-800 text-2xl"
          >
            &times;
          </button>
        </div>
        <div class="p-6 overflow-y-auto">
          <img
            id="detail-modal-image"
            src=""
            alt="Detail Gambar Gunung"
            class="w-full h-64 object-cover rounded-lg mb-4"
          />
          <p id="detail-modal-location" class="text-gray-500 mb-4"></p>
          <p
            id="detail-modal-description"
            class="text-gray-700 leading-relaxed mb-6"
          ></p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
              <h4 class="text-xl font-semibold mb-3 border-b pb-2">
                Estimasi Waktu
              </h4>
              <ul
                id="detail-modal-estimasi"
                class="space-y-2 list-disc list-inside"
              ></ul>
            </div>
            <div>
              <h4 class="text-xl font-semibold mb-3 border-b pb-2">
                Syarat & Peraturan
              </h4>
              <ul
                id="detail-modal-peraturan"
                class="space-y-2 list-disc list-inside"
              ></ul>
            </div>
          </div>
          <div class="mt-8 grid grid-cols-2 gap-4 text-center">
            <div class="bg-green-50 p-4 rounded-lg">
              <p class="text-sm font-semibold">Harga Tiket</p>
              <p
                id="detail-modal-price"
                class="text-xl font-bold text-green-700"
              ></p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
              <p class="text-sm font-semibold">Kuota Harian</p>
              <p
                id="detail-modal-quota"
                class="text-xl font-bold text-green-700"
              ></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="login-modal"
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4"
    >
      <div class="bg-white rounded-lg shadow-2xl w-full max-w-md">
        <div class="p-6 border-b flex justify-between items-center">
          <h3 class="text-2xl font-bold">Login Pengguna</h3>
          <button
            id="close-login-modal-btn"
            class="text-gray-500 hover:text-gray-800 text-2xl"
          >
            &times;
          </button>
        </div>
        <div class="p-6">
          <form id="form-login">
            <div class="mb-4">
              <label for="login_email" class="block font-medium mb-1"
                >Email</label
              ><input
                type="email"
                id="login_email"
                name="email"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-6">
              <label for="login_password" class="block font-medium mb-1"
                >Password</label
              ><input
                type="password"
                id="login_password"
                name="password"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <button
              type="submit"
              class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition"
            >
              Login
            </button>
          </form>
        </div>
      </div>
    </div>

    <div
      id="register-modal"
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4"
    >
      <div
        class="bg-white rounded-lg shadow-2xl w-full max-w-md flex flex-col max-h-[90vh]"
      >
        <div class="p-6 border-b flex justify-between items-center">
          <h3 class="text-2xl font-bold">Daftar Akun Baru</h3>
          <button
            id="close-register-modal-btn"
            class="text-gray-500 hover:text-gray-800 text-2xl"
          >
            &times;
          </button>
        </div>
        <div class="p-6 overflow-y-auto">
          <form id="form-register">
            <div class="mb-4">
              <label for="register_nama" class="block font-medium mb-1"
                >Nama Lengkap</label
              ><input
                type="text"
                id="register_nama"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-4">
              <label for="register_alamat" class="block font-medium mb-1"
                >Alamat</label
              ><input
                type="text"
                id="register_alamat"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-4">
              <label for="register_telepon" class="block font-medium mb-1"
                >Nomor Telepon</label
              ><input
                type="tel"
                id="register_telepon"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-4">
              <label for="register_email" class="block font-medium mb-1"
                >Email</label
              ><input
                type="email"
                id="register_email"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-6">
              <label for="register_password" class="block font-medium mb-1"
                >Password</label
              ><input
                type="password"
                id="register_password"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <button
              type="submit"
              class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition"
            >
              Daftar
            </button>
          </form>
        </div>
      </div>
    </div>

    <div
      id="booking-modal"
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4"
    >
      <div
        class="bg-white rounded-lg shadow-2xl w-full max-w-lg flex flex-col max-h-[90vh]"
      >
        <div class="p-6 border-b flex justify-between items-center">
          <h3 id="modal-title" class="text-2xl font-bold">Formulir Booking</h3>
          <button
            id="close-modal-btn"
            class="text-gray-500 hover:text-gray-800 text-2xl"
          >
            &times;
          </button>
        </div>
        <div class="p-6 overflow-y-auto">
          <form id="form-booking">
            <input type="hidden" id="id_gunung" name="id_gunung" /><input
              type="hidden"
              id="harga_tiket"
              name="harga_tiket"
            />
            <div class="mb-4">
              <label for="nama_lengkap" class="block font-medium mb-1"
                >Nama Lengkap Ketua</label
              ><input
                type="text"
                id="nama_lengkap"
                name="nama_lengkap"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-4">
              <label for="email" class="block font-medium mb-1">Email</label
              ><input
                type="email"
                id="email"
                name="email"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-4">
              <label for="no_telepon" class="block font-medium mb-1"
                >No. Telepon</label
              ><input
                type="tel"
                id="no_telepon"
                name="no_telepon"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-4">
              <label for="tanggal_pendakian" class="block font-medium mb-1"
                >Tanggal Pendakian</label
              ><input
                type="date"
                id="tanggal_pendakian"
                name="tanggal_pendakian"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-4">
              <label for="jumlah_pendaki" class="block font-medium mb-1"
                >Jumlah Pendaki</label
              ><input
                type="number"
                id="jumlah_pendaki"
                name="jumlah_pendaki"
                min="1"
                class="w-full p-2 border rounded"
                required
              />
            </div>
            <div class="mb-4">
              <label for="jalur_pendakian" class="block font-medium mb-1"
                >Jalur Pendakian</label
              ><select
                id="jalur_pendakian"
                name="jalur_pendakian"
                class="w-full p-2 border rounded bg-white"
                required
              ></select>
            </div>
            <hr class="my-6" />
            <div class="mb-4">
              <label class="block font-medium mb-2">Metode Pembayaran</label>
              <div class="flex space-x-4">
                <label class="flex items-center"
                  ><input
                    type="radio"
                    name="metode_pembayaran"
                    value="Transfer Bank"
                    class="mr-2"
                    checked
                  />Transfer Bank</label
                >
                <label class="flex items-center"
                  ><input
                    type="radio"
                    name="metode_pembayaran"
                    value="E-Wallet"
                    class="mr-2"
                  />E-Wallet</label
                >
              </div>
            </div>
            <div
              id="payment-details"
              class="mb-4 p-4 bg-green-50 rounded-lg hidden"
            >
              <p class="font-semibold text-gray-700">
                Silakan lakukan pembayaran ke:
              </p>
              <p id="payment-info" class="text-lg font-bold text-green-700"></p>
            </div>
            <div class="mb-6">
              <label for="bukti_pembayaran" class="block font-medium mb-1"
                >Unggah Bukti Pembayaran</label
              >
              <input
                type="file"
                id="bukti_pembayaran"
                name="bukti_pembayaran"
                class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"
                accept="image/*"
                required
              />
              <img id="image-preview" class="mt-4 rounded-lg hidden max-h-48" />
            </div>
            <button
              type="submit"
              class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition"
            >
              Kirim Booking
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div
      id="toast-notification"
      class="toast fixed bottom-5 right-5 bg-gray-800 text-white py-3 px-6 rounded-lg shadow-lg opacity-0 transform translate-y-10"
    >
      <p id="toast-message"></p>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DATA MANAGEMENT ---
        let gunungData = [];
        let bookingData = [];
        let usersData = [];
        let currentUser = null;

        function initializeData() {
          const defaultGunung = [
            {
              id_gunung: 1,
              nama_gunung: "Gunung Gede",
              lokasi: "Cianjur, Jawa Barat",
              provinsi: "Jawa Barat",
              deskripsi: "Gunung Gede terkenal dengan alun-alun Suryakencana.",
              kuota_harian: 100,
              harga_tiket: 35000,
              jalur: ["Via Cibodas", "Via Gunung Putri"],
              estimasi: ["Basecamp - Puncak: 8 jam"],
              peraturan: ["Wajib membawa surat sehat."],
              gambar:
                "https://images.unsplash.com/photo-1577083288433-3a1d94a81f3a?q=80&w=1974&auto=format&fit=crop",
            },
            {
              id_gunung: 2,
              nama_gunung: "Gunung Rinjani",
              lokasi: "Lombok, NTB",
              provinsi: "Nusa Tenggara Barat",
              deskripsi: "Rinjani menawarkan pemandangan Danau Segara Anak.",
              kuota_harian: 150,
              harga_tiket: 150000,
              jalur: ["Via Sembalun", "Via Senaru"],
              estimasi: ["Basecamp - Puncak: 2 hari"],
              peraturan: ["Wajib menggunakan jasa guide."],
              gambar:
                "https://images.unsplash.com/photo-1596491742335-a78627443468?q=80&w=2070&auto=format&fit=crop",
            },
          ];
          const defaultUsers = [
            {
              id: 1,
              email: "user@example.com",
              password: "password123",
              nama_lengkap: "User Terdaftar",
              isAdmin: false,
            },
            {
              id: 0,
              email: "admin@gmail.com",
              password: "123",
              nama_lengkap: "Admin",
              isAdmin: true,
            },
          ];

          if (!localStorage.getItem("gunungData")) {
            localStorage.setItem("gunungData", JSON.stringify(defaultGunung));
          }
          gunungData = JSON.parse(localStorage.getItem("gunungData"));

          if (!localStorage.getItem("usersData")) {
            localStorage.setItem("usersData", JSON.stringify(defaultUsers));
          }
          usersData = JSON.parse(localStorage.getItem("usersData"));

          if (!localStorage.getItem("bookingData")) {
            localStorage.setItem("bookingData", JSON.stringify([]));
          }
          bookingData = JSON.parse(localStorage.getItem("bookingData"));

          currentUser = JSON.parse(sessionStorage.getItem("currentUser"));
        }

        // --- ELEMENT SELECTORS ---
        const searchInput = document.getElementById("search-gunung");
        const hamburgerBtn = document.getElementById("hamburger-btn");
        const mobileMenu = document.getElementById("mobile-menu");
        const mobileLinks = document.querySelectorAll(".mobile-link");

        // --- MAIN FUNCTIONS ---
        function updateUIforUser() {
          const loginBtn = document.getElementById("login-btn");
          const registerBtn = document.getElementById("register-btn");
          const logoutBtn = document.getElementById("logout-btn");
          const userGreeting = document.getElementById("user-greeting");
          const separator = document.getElementById("separator");
          const profilNavLink = document.getElementById("profil-nav-link");
          const profilNavLinkMobile = document.getElementById(
            "profil-nav-link-mobile"
          );
          const profilSection = document.getElementById("profil-pengguna");

          if (
            !loginBtn ||
            !registerBtn ||
            !separator ||
            !logoutBtn ||
            !userGreeting ||
            !profilNavLink ||
            !profilSection ||
            !profilNavLinkMobile
          )
            return;

          if (currentUser) {
            loginBtn.classList.add("hidden");
            registerBtn.classList.add("hidden");
            separator.classList.add("hidden");
            logoutBtn.classList.remove("hidden");
            userGreeting.textContent = `Halo, ${
              currentUser.nama_lengkap.split(" ")[0]
            }!`;
            userGreeting.classList.remove("hidden");

            profilNavLink.classList.remove("hidden");
            profilNavLinkMobile.classList.remove("hidden");
            profilSection.classList.remove("hidden");

            document.getElementById("profil-nama").textContent =
              currentUser.nama_lengkap;
            document.getElementById("profil-email").textContent =
              currentUser.email;

            renderMyBookings();
          } else {
            loginBtn.classList.remove("hidden");
            registerBtn.classList.remove("hidden");
            separator.classList.remove("hidden");
            logoutBtn.classList.add("hidden");
            userGreeting.classList.add("hidden");

            profilNavLink.classList.add("hidden");
            profilNavLinkMobile.classList.add("hidden");
            profilSection.classList.add("hidden");
          }
        }

        function renderGunungCards(searchText = "") {
          const container = document.getElementById("gunung-list-container");
          const noResultsEl = document.getElementById("no-results");
          if (!container || !noResultsEl) return;

          container.innerHTML = "";
          let filteredData = gunungData.filter(
            (g) =>
              searchText === "" ||
              g.nama_gunung.toLowerCase().includes(searchText)
          );
          noResultsEl.classList.toggle("hidden", filteredData.length > 0);
          filteredData.forEach((gunung) => {
            const card = `
                <div class="gunung-card bg-white rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-2 transition-transform duration-300">
                    <img src="${gunung.gambar}" alt="[Gambar ${
              gunung.nama_gunung
            }]" class="w-full h-48 object-cover cursor-pointer" data-id="${
              gunung.id_gunung
            }" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/4a5568?text=Gambar+Tidak+Tersedia';">
                    <div class="p-6">
                        <h3 class="text-2xl font-bold mb-2">${
                          gunung.nama_gunung
                        }</h3>
                        <p class="text-gray-600 mb-4">${gunung.lokasi}</p>
                        <div class="flex justify-between items-center text-lg">
                           <p class="text-green-600 font-bold">Rp ${gunung.harga_tiket.toLocaleString(
                             "id-ID"
                           )},-</p>
                           <p class="font-semibold">${
                             gunung.kuota_harian
                           } <span class="font-normal">/ hari</span></p>
                        </div>
                        <button data-id="${
                          gunung.id_gunung
                        }" class="open-modal-btn mt-6 w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition">Booking Sekarang</button>
                    </div>
                </div>`;
            container.innerHTML += card;
          });
        }

        // --- EVENT LISTENERS (SAFE) ---
        if (searchInput) {
          searchInput.addEventListener("input", () =>
            renderGunungCards(searchInput.value.toLowerCase())
          );
        }

        if (hamburgerBtn && mobileMenu) {
          hamburgerBtn.addEventListener("click", () => {
            mobileMenu.classList.toggle("hidden");
          });
        }

        if (mobileLinks && mobileMenu) {
          mobileLinks.forEach((link) => {
            link.addEventListener("click", () => {
              mobileMenu.classList.add("hidden");
            });
          });
        }

        // --- INITIALIZATION ---
        initializeData();
        updateUIforUser();
        renderGunungCards();

        // Sisa fungsionalitas (login, modal, dll.) tetap sama
        function renderMyBookings() {
          const container = document.getElementById("my-bookings-list");
          if (!container || !currentUser) return;
          const myBookings = bookingData.filter(
            (b) => b.email === currentUser.email
          );
          if (myBookings.length === 0) {
            container.innerHTML =
              '<p class="text-gray-500">Anda belum memiliki riwayat booking.</p>';
            return;
          }
          container.innerHTML = myBookings
            .map((b) => {
              const bookingCodeDisplay =
                b.status_booking === "Lunas" ? `- ${b.id_booking}` : "";
              return `
                <div class="border p-4 rounded-lg mb-3 hover:bg-gray-50">
                    <p class="font-bold">${
                      b.nama_gunung
                    } ${bookingCodeDisplay}</p>
                    <p class="text-sm text-gray-600">Tgl: ${new Date(
                      b.tanggal_pendakian
                    ).toLocaleDateString(
                      "id-ID"
                    )} | Status: <span class="font-semibold">${
                b.status_booking
              }</span></p>
                </div>`;
            })
            .join("");
        }
        function showToast(message, isSuccess = true) {
          const toast = document.getElementById("toast-notification");
          const toastMessage = document.getElementById("toast-message");
          if (!toast || !toastMessage) return;
          toastMessage.textContent = message;
          toast.className = `toast fixed bottom-5 right-5 text-white py-3 px-6 rounded-lg shadow-lg opacity-0 transform translate-y-10 ${
            isSuccess ? "bg-green-600" : "bg-red-600"
          }`;
          setTimeout(
            () => toast.classList.replace("opacity-0", "opacity-100"),
            100
          );
          setTimeout(
            () => toast.classList.replace("opacity-100", "opacity-0"),
            4000
          );
        }
        const formBooking = document.getElementById("form-booking");
        if (formBooking) {
          formBooking.addEventListener("submit", (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target).entries());
            const gunung = gunungData.find(
              (g) => g.id_gunung == data.id_gunung
            );
            if (!gunung) return;
            const buktiPembayaranInput =
              document.getElementById("bukti_pembayaran");
            const file = buktiPembayaranInput.files[0];
            const createAndSaveBooking = (buktiPembayaranData) => {
              const newBooking = {
                id_booking: "BK-" + Date.now().toString().slice(-6),
                id_user: currentUser ? currentUser.id : null,
                id_gunung: parseInt(data.id_gunung),
                tanggal_pendakian: data.tanggal_pendakian,
                jumlah_pendaki: parseInt(data.jumlah_pendaki),
                total_biaya:
                  parseInt(data.jumlah_pendaki) * parseInt(data.harga_tiket),
                status_booking: "Menunggu Konfirmasi",
                nama_lengkap: data.nama_lengkap,
                email: data.email,
                nama_gunung: gunung.nama_gunung,
                jalur_pendakian: data.jalur_pendakian,
                metode_pembayaran: data.metode_pembayaran,
                bukti_pembayaran: buktiPembayaranData,
              };
              bookingData.push(newBooking);
              localStorage.setItem("bookingData", JSON.stringify(bookingData));
              const bookingModal = document.getElementById("booking-modal");
              if (bookingModal) bookingModal.classList.add("hidden");
              showToast(
                "Booking berhasil! Silakan tunggu konfirmasi dari admin."
              );
              if (currentUser) renderMyBookings();
            };
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                createAndSaveBooking(event.target.result);
              };
              reader.readAsDataURL(file);
            } else {
              createAndSaveBooking(null);
            }
          });
        }
        const formCekBooking = document.getElementById("form-cek-booking");
        if (formCekBooking) {
          formCekBooking.addEventListener("submit", (e) => {
            e.preventDefault();
            const hasilContainer = document.getElementById("hasil-cek-booking");
            const kodeCek = document.getElementById("kode_booking_cek").value;
            const booking = bookingData.find(
              (b) => b.id_booking.toLowerCase() === kodeCek.toLowerCase()
            );
            if (hasilContainer) {
              if (booking) {
                const statusClass =
                  booking.status_booking === "Lunas"
                    ? "text-green-600"
                    : "text-amber-600";
                let detailHTML = `<h4 class="text-xl font-bold mb-4 border-b pb-2">Detail Booking</h4>`;
                if (booking.status_booking === "Lunas") {
                  detailHTML += `<p><strong>Kode:</strong> ${booking.id_booking}</p>`;
                }
                detailHTML += `<p><strong>Nama:</strong> ${booking.nama_lengkap}</p><p><strong>Gunung:</strong> ${booking.nama_gunung}</p><p><strong>Status:</strong> <span class="font-bold ${statusClass}">${booking.status_booking}</span></p>`;
                if (booking.status_booking !== "Lunas") {
                  detailHTML += `<p class="mt-2 text-sm text-gray-500">Kode booking akan ditampilkan setelah pesanan Anda dikonfirmasi.</p>`;
                }
                hasilContainer.innerHTML = detailHTML;
              } else {
                hasilContainer.innerHTML = `<p class="text-red-600 text-center">Kode booking tidak ditemukan.</p>`;
              }
              hasilContainer.classList.remove("hidden");
            }
          });
        }

        function closeModal(modal) {
          if (modal) modal.classList.add("hidden");
        }
        const loginBtn = document.getElementById("login-btn"),
          registerBtn = document.getElementById("register-btn"),
          detailModal = document.getElementById("detail-modal"),
          loginModal = document.getElementById("login-modal"),
          registerModal = document.getElementById("register-modal"),
          bookingModal = document.getElementById("booking-modal"),
          closeDetailModalBtn = document.getElementById(
            "close-detail-modal-btn"
          ),
          closeLoginModalBtn = document.getElementById("close-login-modal-btn"),
          closeRegisterModalBtn = document.getElementById(
            "close-register-modal-btn"
          ),
          closeModalBtn = document.getElementById("close-modal-btn"),
          gunungListContainer = document.getElementById(
            "gunung-list-container"
          );
        if (loginBtn && loginModal)
          loginBtn.addEventListener("click", () =>
            loginModal.classList.remove("hidden")
          );
        if (registerBtn && registerModal)
          registerBtn.addEventListener("click", () =>
            registerModal.classList.remove("hidden")
          );
        if (closeDetailModalBtn)
          closeDetailModalBtn.addEventListener("click", () =>
            closeModal(detailModal)
          );
        if (closeLoginModalBtn)
          closeLoginModalBtn.addEventListener("click", () =>
            closeModal(loginModal)
          );
        if (closeRegisterModalBtn)
          closeRegisterModalBtn.addEventListener("click", () =>
            closeModal(registerModal)
          );
        if (closeModalBtn)
          closeModalBtn.addEventListener("click", () => {
            document.getElementById("form-booking").reset();
            document.getElementById("image-preview").classList.add("hidden");
            document.getElementById("payment-details").classList.add("hidden");
            closeModal(bookingModal);
          });
        [detailModal, loginModal, registerModal, bookingModal].forEach(
          (modal) => {
            if (modal)
              modal.addEventListener("click", (e) => {
                if (e.target === modal) closeModal(modal);
              });
          }
        );
        if (gunungListContainer)
          gunungListContainer.addEventListener("click", (e) => {
            const target = e.target;
            if (target.classList.contains("open-modal-btn")) {
              if (currentUser) {
                openBookingModal(target.getAttribute("data-id"));
              } else {
                showToast(
                  "Anda harus login terlebih dahulu untuk booking.",
                  false
                );
                if (loginModal) loginModal.classList.remove("hidden");
              }
            } else if (target.tagName === "IMG" && target.dataset.id) {
              openDetailModal(target.dataset.id);
            }
          });
        function openDetailModal(gunungId) {
          if (!detailModal) return;
          const gunung = gunungData.find((g) => g.id_gunung == gunungId);
          if (!gunung) return;
          document.getElementById("detail-modal-title").textContent =
            gunung.nama_gunung;
          document.getElementById("detail-modal-image").src = gunung.gambar;
          document.getElementById(
            "detail-modal-location"
          ).textContent = ` ${gunung.lokasi}`;
          document.getElementById("detail-modal-description").textContent =
            gunung.deskripsi;
          document.getElementById(
            "detail-modal-price"
          ).textContent = `Rp ${gunung.harga_tiket.toLocaleString("id-ID")},-`;
          document.getElementById(
            "detail-modal-quota"
          ).textContent = `${gunung.kuota_harian} orang`;
          document.getElementById("detail-modal-estimasi").innerHTML =
            gunung.estimasi.map((e) => `<li>${e}</li>`).join("");
          document.getElementById("detail-modal-peraturan").innerHTML =
            gunung.peraturan.map((p) => `<li>${p}</li>`).join("");
          detailModal.classList.remove("hidden");
        }
        function openBookingModal(gunungId) {
          if (!bookingModal) return;
          const gunung = gunungData.find((g) => g.id_gunung == gunungId);
          if (!gunung) return;
          document.getElementById(
            "modal-title"
          ).textContent = `Booking: ${gunung.nama_gunung}`;
          document.getElementById("id_gunung").value = gunung.id_gunung;
          document.getElementById("harga_tiket").value = gunung.harga_tiket;
          document.getElementById("tanggal_pendakian").min = new Date()
            .toISOString()
            .split("T")[0];
          const jalurSelect = document.getElementById("jalur_pendakian");
          jalurSelect.innerHTML = "";
          gunung.jalur.forEach((jalur) => {
            const option = document.createElement("option");
            option.value = jalur;
            option.textContent = jalur;
            jalurSelect.appendChild(option);
          });
          if (currentUser) {
            document.getElementById("nama_lengkap").value =
              currentUser.nama_lengkap;
            document.getElementById("email").value = currentUser.email;
            document.getElementById("no_telepon").value =
              currentUser.no_telepon || "";
          }
          bookingModal.classList.remove("hidden");
          updatePaymentDetails();
        }
        function updatePaymentDetails() {
          const paymentInfoText = document.getElementById("payment-info"),
            paymentDetailsContainer =
              document.getElementById("payment-details");
          if (!paymentInfoText || !paymentDetailsContainer) return;
          const selectedMethod = document.querySelector(
            'input[name="metode_pembayaran"]:checked'
          ).value;
          let info =
            selectedMethod === "Transfer Bank"
              ? "BCA: 123-456-7890 a/n Mountaineer"
              : "GoPay/OVO: 0812-3456-7890 a/n Mountaineer";
          paymentInfoText.textContent = info;
          paymentDetailsContainer.classList.remove("hidden");
        }
        const buktiPembayaranInput =
            document.getElementById("bukti_pembayaran"),
          imagePreview = document.getElementById("image-preview");
        if (buktiPembayaranInput && imagePreview)
          buktiPembayaranInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                imagePreview.src = event.target.result;
                imagePreview.classList.remove("hidden");
              };
              reader.readAsDataURL(file);
            }
          });
        const paymentMethodRadios = document.querySelectorAll(
          'input[name="metode_pembayaran"]'
        );
        if (paymentMethodRadios)
          paymentMethodRadios.forEach((radio) =>
            radio.addEventListener("change", updatePaymentDetails)
          );
        const formLogin = document.getElementById("form-login");
        if (formLogin)
          formLogin.addEventListener("submit", (e) => {
            e.preventDefault();
            const email = e.target.email.value,
              password = e.target.password.value;
            const foundUser = usersData.find(
              (u) => u.email === email && u.password === password
            );
            if (foundUser) {
              sessionStorage.setItem("currentUser", JSON.stringify(foundUser));
              if (foundUser.isAdmin) {
                showToast("Login admin berhasil! Mengarahkan...");
                window.location.href = "admin.html";
              } else {
                currentUser = foundUser;
                updateUIforUser();
                closeModal(loginModal);
                e.target.reset();
                showToast(`Selamat datang, ${currentUser.nama_lengkap}!`);
              }
            } else {
              showToast("Email atau password salah.", false);
            }
          });
        const formRegister = document.getElementById("form-register");
        if (formRegister)
          formRegister.addEventListener("submit", (e) => {
            e.preventDefault();
            const email = document.getElementById("register_email").value;
            if (usersData.find((u) => u.email === email)) {
              showToast("Email sudah terdaftar.", false);
              return;
            }
            const newUser = {
              id: Date.now(),
              nama_lengkap: document.getElementById("register_nama").value,
              alamat: document.getElementById("register_alamat").value,
              no_telepon: document.getElementById("register_telepon").value,
              email: email,
              password: document.getElementById("register_password").value,
              isAdmin: false,
            };
            usersData.push(newUser);
            localStorage.setItem("usersData", JSON.stringify(usersData));
            closeModal(registerModal);
            e.target.reset();
            showToast("Pendaftaran berhasil! Silakan login.");
            if (loginModal) {
              document.getElementById("login_email").value = email;
              loginModal.classList.remove("hidden");
            }
          });
        const logoutBtn = document.getElementById("logout-btn");
        if (logoutBtn)
          logoutBtn.addEventListener("click", () => {
            showToast("Anda telah logout.");
            currentUser = null;
            sessionStorage.removeItem("currentUser");
            updateUIforUser();
          });
      });
    </script>
  </body>
</html>
